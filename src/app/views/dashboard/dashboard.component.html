<div *ngIf="isLoader" class="divloader">
</div>

<br>

<div class="">
  <div class="col-md-12">
    <!--div class="card">
      <div class="card-header">
        Hi {{ DisplayName}}!
      </div-->
    <tabset type="pills">
      <tab heading="Dashboard">
        <div class="card-body tblHtscroll">
          

          <form [formGroup]='searchForm'>
            <div class="row">
              <div class="col-sm-12 col-md-1">
                <div class="form-group">
                  <label style="width:100%" class="control-label">Year</label>
                  

                    <ng-select
                    [clearable]="false"
  [items]="dataYear"
  bindLabel="text"
  bindValue="id"
   formControlName="year"
  placeholder="Please Select"
  (change)="changedYear($event)" 
  [ngStyle]="{ width: '80px' }"
  >
</ng-select>
                 
                </div>
              </div>
              
              <div class="col-sm-12 col-md-1">
                <div class="form-group">
                  <label style="width:100%" class="control-label">Month</label>
                    <ng-select   
                    [clearable]="false"
                    bindLabel="text"
                    bindValue="id" 
                    formControlName="month" 
                    [items]="dataMonth" 
                    (change)="changedMonth($event)" 
                    placeholder="Please Select"
                    [ngStyle]="{ width: '70px' }">                      
                    </ng-select>
                </div>
              </div>
              <div class="col-sm-12 col-md-3">
                <div class="form-group">
                  <label style="width:100%" class="control-label">Department</label>
                  <ng-select  
                  [clearable]="false"
                   bindLabel="text"
                    bindValue="id" 
                    formControlName="department"  
                    [items]="dataDepartment"
                    (change)="changedDepartment($event)" 
                    placeholder="Please Select"
                    [ngStyle]="{ width: '160px' }">
                  </ng-select>
                </div>
              </div>
              <div class="col-sm-12 col-md-3">
                <div class="form-group">
                  <label style="width:100%" class="control-label">Budget Type</label>
                  <ng-select  
                  [clearable]="false"
                   bindLabel="text"
                    bindValue="id" 
                    formControlName="budgetType" 
                     [items]="dataBudgetType"
                    (change)="changedBudgetType($event)" 
                    placeholder="Please Select"
                    [ngStyle]="{ width: '160px' }">
                  </ng-select>
                </div>
              </div>
              <div class="col-sm-12 col-md-3">
                <div class="form-group">
                  <label style="width:100%" class="control-label">Project Category</label>
                  <ng-select  
                  [clearable]="false"
                   bindLabel="text"
                  bindValue="id" 
                  formControlName="projectCategory"  
                  [items]="dataProjectCategory"
                    (change)="changedProjectCategory($event)" 
                    placeholder="Please Select"
                    [ngStyle]="{ width: '160px' }">
                  </ng-select>
                </div>
              </div>
              <div class="col-sm-12 col-md-1">&nbsp;</div>
            </div>
          </form>
          <div class="row"  *ngIf="isBrowser">
            <div class="col-sm-12 col-md-6">

              <!-- <highcharts-chart [Highcharts] = "Highcharts1" [options] = "chartOptions1" style = "width: 100%; height: 400px; display: block;margin:auto">
              </highcharts-chart> -->
              <highcharts-chart [Highcharts] = "Highcharts1" [options] = "budgetOverviewOptions" style = "width: 100%; height: 400px; display: block;margin:auto">
              </highcharts-chart>
            </div>
            <div class="col-sm-12 col-md-6">
              <highcharts-chart [Highcharts] = "Highcharts1" [options] = "budgetStatusOptions"  style = "width: 100%; height: 400px; display: block;margin:auto">
              </highcharts-chart>
            </div>
          </div>
          <div class="row" *ngIf="isBrowser">
            <div class="col-sm-12 col-md-12">
              &nbsp;
            </div>
          </div>
          <div class="row" *ngIf="isBrowser">
            <div class="col-sm-12 col-md-6">
              <div *ngIf="budgetoverview1" style="width:100%;">
                <table *ngIf="budgetoverview1"
                  class="table table-bordered  table-responsive-sm table-hover table-outline"
                  style="white-space:normal;font-size: 0.70rem !important;">
                  <thead>
                    <th colspan="3">
                      Budget Overview
                    </th>
                  </thead>
                  <tbody>
                    <tr>
                      <th>Total Budget</th>
                      <td style="text-align: right;">{{TotalAmount| number:'1.2-2'}}</td>
                      <td style="text-align: right;">100%</td>
                    </tr>
                    <tr>
                      <th>Balance</th>
                      <td style="text-align: right;">{{BalanceAmount| number:'1.2-2'}}</td>
                      <td style="text-align: right;"> {{ (BalanceAmount/TotalAmount) * 100 | number:'1.2-2' }} % </td>
                    </tr>
                    <tr>
                      <th>Booked</th>
                      <td style="text-align: right;">{{BookedAmount| number:'1.2-2'}}</td>
                      <td style="text-align: right;"> {{ (BookedAmount/TotalAmount) * 100 | number:'1.2-2' }} % </td>
                    </tr>
                    <tr>
                      <th>Spent</th>
                      <td style="text-align: right;">{{SpentAmount| number:'1.2-2'}}</td>
                      <td style="text-align: right;"> {{ (SpentAmount/TotalAmount) * 100 | number:'1.2-2' }} % </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="budgetoverview2" style="width:100%;">
                <table *ngIf="budgetoverview2"
                  class="table table-bordered  table-responsive-sm table-hover table-outline"
                  style="white-space:normal;font-size: 0.70rem !important;">
                  <thead>
                    <th colspan="8">Summary</th>
                  </thead>
                  <thead>
                    <th>Function</th>
                    <th>Budget</th>
                    <th>Balance</th>
                    <th title="Funds saved as Draft, Approved in BBF. PR & PO Amount Raised ">Booked</th>
                    <th title="PO Amount Received & Invoiced">Spent</th>
                    <th>Spent%</th>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of functionOverviewFilter">
                      <td><b>{{item.totalLevel1}}</b></td>
                      <td style="text-align: right;">{{item.totalAmount | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.balance | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.booked | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.spent | number:'1.2-2'}}</td>
                      <td style="text-align: right;"> {{ (item.spent/item.totalAmount) * 100 | number:'1.2-2' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="budgetoverview3" style="width:100%;">
                <table *ngIf="budgetoverview3"
                  class="table table-bordered  table-responsive-sm table-hover table-outline"
                  style="white-space:normal;font-size: 0.70rem !important;">
                  <thead>
                    <th colspan="3">
                      {{budgetoverviewFunctionname}} - alwar
                    </th>
                  </thead>
                  <tbody>
                    <tr>
                      <th>Total Budget</th>
                      <td style="text-align: right;">{{ functionOverviewItem[0].totalAmount  | number:'1.2-2'}}</td>
                      <td style="text-align: right;">100%</td>
                    </tr>
                    <tr>
                      <th>Balance</th>
                      <td style="text-align: right;">{{ functionOverviewItem[0].balance | number:'1.2-2'}}</td>
                      <td style="text-align: right;">
                        {{ (functionOverviewItem[0].balance/functionOverviewItem[0].totalAmount) * 100 | number:'1.2-2' }}
                        %
                      </td>
                    </tr>
                    <tr>
                      <th>Booked</th>
                      <td style="text-align: right;">{{ functionOverviewItem[0].booked | number:'1.2-2'}}</td>
                      <td style="text-align: right;">
                        {{ (functionOverviewItem[0].booked/functionOverviewItem[0].totalAmount) * 100 | number:'1.2-2' }}
                        %
                      </td>
                    </tr>
                    <tr>
                      <th>Spent</th>
                      <td style="text-align: right;">{{ functionOverviewItem[0].spent | number:'1.2-2'}}</td>
                      <td style="text-align: right;">
                        {{ (functionOverviewItem[0].spent/functionOverviewItem[0].totalAmount) * 100 | number:'1.2-2' }}
                        %
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="col-sm-12 col-md-6">
              <div *ngIf="budgetOverViewStatus1" style="width:100%;">
                <table *ngIf="budgetOverViewStatus1"
                  class="table table-bordered  table-responsive-sm table-hover table-outline"
                  style="white-space:normal;font-size: 0.70rem !important;">
                  <thead>
                    <th colspan="8">Summary</th>
                  </thead>
                  <thead>
                    <th>Function</th>
                    <th>Budget</th>
                    <th>Balance</th>
                    <th title="Funds saved as Draft, Approved in BBF. PR & PO Amount Raised ">Booked</th>
                    <th title="PO Amount Received & Invoiced">Spent</th>
                    <th>Spent%</th>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of functionOverviewFilter1">
                      <td><b>{{item.totalLevel1}}</b></td>
                      <td style="text-align: right;">{{item.totalAmount | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.balance | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.booked | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.spent | number:'1.2-2'}}</td>
                      <td style="text-align: right;"> {{ (item.spent/item.totalAmount) * 100 | number:'1.2-2' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="budgetOverViewStatus2" style="width:100%;">
                <table *ngIf="budgetOverViewStatus2"
                  class="table table-bordered  table-responsive-sm table-hover table-outline"
                  style="white-space:normal;font-size: 0.70rem !important;">
                  <thead>
                    <th colspan="8">Summary - {{ budgetstatusFunctionname }}</th>
                  </thead>
                  <thead>
                    <th>Function</th>
                    <th>Budget</th>
                    <th>Balance</th>
                    <th title="Funds saved as Draft, Approved in BBF. PR & PO Amount Raised ">Booked</th>
                    <th title="PO Amount Received & Invoiced">Spent</th>
                    <th>Spent%</th>
                  </thead>
                  <tbody>
                    <tr *ngFor="let item of functionOverviewL2Filter">
                      <td style="width:100px !important"><b>{{item.totalLevel2}}</b></td>
                      <td style="text-align: right;">{{item.totalAmount | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.balance | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.booked | number:'1.2-2'}}</td>
                      <td style="text-align: right;">{{item.spent | number:'1.2-2'}}</td>
                      <td style="text-align: right;"> {{ (item.spent/item.totalAmount) * 100 | number:'1.2-2' }}</td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div *ngIf="budgetOverViewStatus3" style="width:100%;">
                <table *ngIf="budgetOverViewStatus3"
                  class="table table-bordered  table-responsive-sm table-hover table-outline"
                  style="white-space:normal;font-size: 0.70rem !important;">
                  <thead>
                    <th colspan="3">
                      {{ functionOverviewL2Item[0].totalLevel1 }} - {{ functionOverviewL2Item[0].totalLevel2 }}
                    </th>
                  </thead>
                  <tbody>
                    <tr>
                      <th>Total Budget</th>
                      <td style="text-align: right;">{{ functionOverviewL2Item[0].totalAmount  | number:'1.2-2'}}</td>
                      <td style="text-align: right;">100%</td>
                    </tr>
                    <tr>
                      <th>Balance</th>
                      <td style="text-align: right;">{{ functionOverviewL2Item[0].BALANCE | number:'1.2-2'}}</td>
                      <td style="text-align: right;">
                        {{ (functionOverviewL2Item[0].balance/functionOverviewL2Item[0].totalAmount) * 100 | number:'1.2-2' }}
                        %
                      </td>
                    </tr>
                    <tr>
                      <th>Booked</th>
                      <td style="text-align: right;">{{ functionOverviewL2Item[0].BOOKED | number:'1.2-2'}}</td>
                      <td style="text-align: right;">
                        {{ (functionOverviewL2Item[0].booked/functionOverviewL2Item[0].totalAmount) * 100 | number:'1.2-2' }}
                        %
                      </td>
                    </tr>
                    <tr>
                      <th>Spent</th>
                      <td style="text-align: right;">{{ functionOverviewL2Item[0].SPENT | number:'1.2-2'}}</td>
                      <td style="text-align: right;">
                        {{ (functionOverviewL2Item[0].spent/functionOverviewL2Item[0].totalAmount) * 100 | number:'1.2-2' }}
                        %
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          <div class="row" *ngIf="isBrowser">
            <div class="col-sm-12 col-md-12">
              &nbsp;
            </div>
          </div>
          <div class="row" *ngIf="isBrowser">
            <div class="col-sm-12 col-md-12">
              <!--div #budgetChart style="width:100%;margin:auto">
                &nbsp;
              </div-->
              <highcharts-chart [Highcharts] = "Highcharts1" [options] = "budgetChartOptions" style = "width: 100%; height: 400px; display: block;margin:auto">
              </highcharts-chart>
            </div>
          </div>
        </div>
      </tab>
      <tab heading="My Approvals" style="color: #8a1538;">
        <div class="tblHtscroll">
          <div class="row">
            <div class="col-md-12">
              <accordion>
                <accordion-group heading="Pending Approvals"  [isOpen]=true>
                  <table id="tblPendingAttachements" class="table table-bordered">
                    <thead class="thead-light">
                      <tr>
                        <th>Select</th>
                        <th>Booking Number</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr *ngFor="let item of objPendingApproval">
                        <td>
                          <a style="cursor: pointer;" (click)="bbfPendingApproval(item)"> <i class="cui-speech"></i>
                            View </a>
                        </td>
                        <td>{{item.bbHeaderId}}</td>
                      </tr>
                    </tbody>
                  </table>
                </accordion-group>
              </accordion>
            </div>
          </div>
          <div class="row" *ngIf="approvalView">
            <div class="col-md-12">
              <div class="card">
                <div class="card-header">{{modaltitle}} - <b>{{BBFNo}}</b></div>
                <div class="card-body" [class.hide]="applyHideClassForBooking">
                  <form [formGroup]="angForm" novalidate>
                    <!--div class="row">
                      <div class="col-sm-12 col-md-12" style="text-align: right !important;">
                        <h6>Welcome : {{userName}}</h6>
                      </div>
                    </div-->
                    <div class="row" *ngIf="isBtnApprvEnabled">
                      <div class="col-sm-12 col-md-2 ">
                        <div class="form-group">
                          <label style="width:100%" class="control-label">Requested By</label>
                          <input class="form-control  text-left" readonly formControlName="requestedby">
                        </div>
                      </div>
                      <div class="col-sm-12 col-md-2">
                        <div class="form-group">
                          <label style="width:100%" class="control-label">Funds Requested</label>
                          <input class="form-control  text-right" readonly
                            [value]="angForm.get('totalAmount')?.value |  number:'1.2-5'" formControlName="totalAmount">
                        </div>
                      </div>
                    </div>
                    <div class="row" *ngIf="isBtnApprvEnabled">
                      <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                          <label style="width:100%" class="control-label">Description</label>
                          <textarea class="form-control" formControlName="description" name="textarea-input"
                            placeholder="description.." readonly rows="3"></textarea>
                        </div>
                      </div>
                      <div class="col-sm-12 col-md-6">
                        <div class="form-group">
                          <label style="width:100%" class="control-label">Justification</label>
                          <textarea class="form-control" formControlName="justification" name="textarea-input"
                            placeholder="justification.." readonly rows="3"></textarea>
                        </div>
                      </div>
                    </div>
                    <div class="row" *ngIf="isBtnApprvEnabled">
                      <div class="col-sm-12 col-md-12">
                        <div class="form-group">
                          <label style="width:100%" class="control-label">Remarks</label>
                          <textarea class="form-control" formControlName="remarks" name="textarea-input"
                            placeholder="Content.." rows="3"></textarea>
                        </div>
                      </div>
                    </div>
                    <div class="row" *ngIf="isBtnApprvEnabled">
                      <div class="col-md-8">
                        <div class="maxwidth" style="max-height:200px; width:100%;overflow:auto;">
                          <table id="tblbookinglines" class="table table-bordered table-responsive-sm display">
                            <thead class="thead-light">
                              <tr>
                                <th>PROJECT NAME</th>
                                <th>POET NO.</th>
                                <th>SPEND</th>
                                <th>BALANCE</th>
                              </tr>
                            </thead>
                            <tbody>
                              <tr *ngFor="let poet of objPoetUserData">
                                <td>{{ poet.projectName }}</td>
                                <td>{{ poet.poetNumber }}</td>
                                <td class=" text-right">{{ poet.lineAmount |  number:'1.2-5'  }}</td>
                                <td class=" text-right">{{ poet.YEARLYBUDGET - poet.BALANCE  |  number:'1.2-5' }}</td>
                              </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                      <div class="col-md-4">
                        <div class="form-group">
                          <div class="maxwidth" style="max-height:200px; width:100%;overflow:auto;">
                            <table id="tblbookingAttachments"
                              class="table table-bordered table-responsive-sm display nowrap"
                              style="white-space: nowrap">
                              <thead class="thead-light">
                                <tr>
                                  <th>Attached File</th>
                                </tr>
                              </thead>
                              <tbody>
                                <tr *ngFor="let poet of objBudgetAttachments; index as i">
                                  <td>
                                    <a (click)="downloadFile(poet)" style="cursor: pointer;
                                                color: #8a1538 !important;
                                                font-weight: 600;
                                                font-size: 13px;">
                                      {{poet.fileName }}
                                    </a>
                                  </td>
                                </tr>
                              </tbody>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div *ngIf="!isBtnApprvEnabled">
                      <div class="row">
                        <div class="col-sm-12 col-md-12">
                          <h5>{{message}}</h5>
                        </div>
                      </div>
                      <div class="row">
                        <div class="col-sm-12 col-md-12">&nbsp;</div>
                      </div>
                    </div>
                  </form>
                  <div class="modal-footer" *ngIf="isBtnApprvEnabled">
                    <button type="submit" *ngIf="isBtnEnabled" class="btn btn-success" [swal]="{ title: 'Are you sure?',
          text: 'You want to Initiate Approval!',
          allowOutsideClick:false, 
          icon: 'warning',
          showConfirmButton:true,
          showCancelButton:true  }" (confirm)="saveDatatoDB(angForm,true)" (cancel)="handleRefusalData($event)">
                      Approve
                      <!-- <i class="fa fa-spinner fa-spin fa-fw" *ngIf="loading"></i> -->
                    </button>
                    <button type="submit" *ngIf="isBtnEnabled" [disabled]="angForm.value.remarks === ''"
                      class="btn btn-success" [swal]="{ title: 'Are you sure?',
        text: 'You want to save the data!',
        allowOutsideClick:false, 
        icon: 'warning',
        showConfirmButton:true,
        showCancelButton:true  }" (confirm)="saveDatatoDB(angForm,false)" (cancel)="handleRefusalData($event)">
                      Reject
                      <!-- <i class="fa fa-spinner fa-spin fa-fw" *ngIf="loading"></i> -->
                    </button>
                    <button type="button" class="btn btn-outline-dark hide">Close</button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="row">
            <div class="col-md-12">&nbsp;</div>
          </div>
          <div class="row">
            <div class="col-md-12">&nbsp;</div>
          </div>
          <div class="row">
            <div class="col-md-12">&nbsp;</div>
          </div>
          <div class="row">
            <div class="col-md-12">&nbsp;</div>
          </div>
          <div class="row">
            <div class="col-md-12">&nbsp;</div>
          </div>
          <div class="row">
            <div class="col-md-12">&nbsp;</div>
          </div>
        </div>
      </tab>
    </tabset>

    <!--/div-->
  </div>
  <!--/.col-->
</div>
<!--/.row-->